# ============================================
# ENVIRONMENT VARIABLES FOR HOSTINGER
# ============================================
# IMPORTANT: Replace all placeholder values below with your actual credentials
# These variables will be available to Laravel via getenv() and $_SERVER
# 
# To generate APP_KEY: Run "php artisan key:generate" locally and copy the key
# To generate JWT_SECRET: Run "php artisan jwt:secret" locally and copy the secret
# 
# After updating, test by running: php artisan config:clear
# ============================================

# Application Settings
SetEnv APP_NAME "FeeAdmin"
SetEnv APP_ENV "production"
SetEnv APP_DEBUG "false"
SetEnv APP_URL "https://yourdomain.com"
SetEnv APP_KEY "base64:YOUR_APP_KEY_HERE"
SetEnv APP_TIMEZONE "UTC"

# Database Configuration
SetEnv DB_CONNECTION "mysql"
SetEnv DB_HOST "localhost"
SetEnv DB_PORT "3306"
SetEnv DB_DATABASE "your_database_name"
SetEnv DB_USERNAME "your_database_username"
SetEnv DB_PASSWORD "your_database_password"

# Session Configuration
SetEnv SESSION_DRIVER "database"
SetEnv SESSION_SECURE_COOKIE "true"
SetEnv SESSION_HTTP_ONLY "true"
SetEnv SESSION_SAME_SITE "lax"
SetEnv SESSION_LIFETIME "120"

# Logging Configuration
SetEnv LOG_CHANNEL "daily"
SetEnv LOG_LEVEL "error"

# JWT Configuration
SetEnv JWT_SECRET "your_jwt_secret_key_here"

# ============================================
# LARAVEL ROUTING & SECURITY
# ============================================

<IfModule mod_rewrite.c>
    <IfModule mod_negotiation.c>
        Options -MultiViews -Indexes
    </IfModule>

    RewriteEngine On

    # ============================================
    # SECURITY: Block access to sensitive files
    # ============================================
    
    # Block access to .env files
    <FilesMatch "^\.">
        Order allow,deny
        Deny from all
    </FilesMatch>
    
    # Block access to .env and environment files
    <FilesMatch "\.(env|env\.backup|env\.production|env\.local)$">
        Order allow,deny
        Deny from all
    </FilesMatch>
    
    # Block access to sensitive Laravel files
    <FilesMatch "(composer\.(json|lock)|package(-lock)?\.json|\.git|\.gitignore|\.gitattributes|artisan|phpunit\.xml|\.env\.example)$">
        Order allow,deny
        Deny from all
    </FilesMatch>
    
    # Block access to sensitive directories (if accessed directly)
    RewriteCond %{REQUEST_URI} ^/(storage|vendor|bootstrap/cache|config|database|routes|app|resources|tests|node_modules) [NC]
    RewriteRule ^ - [F,L]
    
    # Block access to hidden files and directories
    RewriteCond %{SCRIPT_FILENAME} -d [OR]
    RewriteCond %{SCRIPT_FILENAME} -f
    RewriteRule "(^|/)\." - [F,L]
    
    # Block access to backup files
    <FilesMatch "\.(bak|backup|old|orig|save|swp|tmp)$">
        Order allow,deny
        Deny from all
    </FilesMatch>
    
    # Block database dump files and SQL files
    <FilesMatch "\.(sql|dump|db|sqlite|sqlite3|mdb)$">
        Order allow,deny
        Deny from all
    </FilesMatch>
    
    # Block access to configuration files that might expose environment variables
    <FilesMatch "(config\.php|settings\.php|database\.php|\.config)$">
        Order allow,deny
        Deny from all
    </FilesMatch>
    
    # Block JWT key files
    <FilesMatch "(jwt|jwt-key|\.key|\.pem|\.p12|\.pfx)$">
        Order allow,deny
        Deny from all
    </FilesMatch>
    
    # Block attempts to access environment variable names in URLs
    # Prevents information disclosure through URL parameters
    RewriteCond %{QUERY_STRING} (DB_PASSWORD|DB_USERNAME|DB_HOST|DB_DATABASE|APP_KEY|JWT_SECRET|AWS_SECRET|REDIS_PASSWORD|MAIL_PASSWORD) [NC]
    RewriteRule ^ - [F,L]
    
    # Block access to files containing sensitive variable names
    RewriteCond %{REQUEST_URI} (\.env|database|config|secret|key|password|credential) [NC]
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteRule !^index\.php$ - [F,L]
    
    # Block access to database-related directories
    RewriteCond %{REQUEST_URI} ^/(backup|backups|dump|dumps|database|db|sql) [NC]
    RewriteRule ^ - [F,L]

    # ============================================
    # SECURITY HEADERS
    # ============================================
    
    <IfModule mod_headers.c>
        # Prevent clickjacking
        Header always set X-Frame-Options "SAMEORIGIN"
        
        # XSS Protection
        Header always set X-XSS-Protection "1; mode=block"
        
        # Prevent MIME type sniffing
        Header always set X-Content-Type-Options "nosniff"
        
        # Referrer Policy
        Header always set Referrer-Policy "strict-origin-when-cross-origin"
        
        # Remove server information
        Header unset Server
        Header unset X-Powered-By
    </IfModule>

    # ============================================
    # LARAVEL ROUTING
    # ============================================

    # Handle Authorization Header
    RewriteCond %{HTTP:Authorization} .
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

    # Redirect Trailing Slashes If Not A Folder...
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} (.+)/$
    RewriteRule ^ %1 [L,R=301]

    # Send Requests To Front Controller...
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^ index.php [L]
</IfModule>

# ============================================
# DISABLE DIRECTORY LISTING
# ============================================
Options -Indexes

# ============================================
# PHP SECURITY SETTINGS
# ============================================
<IfModule mod_php.c>
    # Hide PHP version
    php_flag expose_php Off
    
    # Disable dangerous PHP functions (if needed)
    # php_admin_value disable_functions "exec,passthru,shell_exec,system,proc_open,popen"
</IfModule>

